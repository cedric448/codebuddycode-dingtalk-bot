# è„šæœ¬è¯´æ˜

æœ¬ç›®å½•åŒ…å«é’‰é’‰æœºå™¨äººé¡¹ç›®çš„æ‰€æœ‰ç®¡ç†å’Œéƒ¨ç½²è„šæœ¬ã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

### Systemd æœåŠ¡ç®¡ç†è„šæœ¬

- **start.sh** - ä¸€é”®å¯åŠ¨æœåŠ¡ï¼ˆè‡ªåŠ¨å®‰è£…ä¾èµ–ã€é…ç½®æœåŠ¡ï¼‰
- **stop.sh** - åœæ­¢æ‰€æœ‰æœåŠ¡
- **status.sh** - æŸ¥çœ‹æœåŠ¡çŠ¶æ€

### Docker ç®¡ç†è„šæœ¬

- **docker-deploy.sh** - Dockerä¸€é”®éƒ¨ç½²
- **docker-start.sh** - å¯åŠ¨Dockerå®¹å™¨
- **docker-stop.sh** - åœæ­¢Dockerå®¹å™¨
- **docker-status.sh** - æŸ¥çœ‹Dockerå®¹å™¨çŠ¶æ€

### ç›‘æ§å’ŒéªŒè¯è„šæœ¬

- **check_async_status.sh** - æ£€æŸ¥å¼‚æ­¥åŠŸèƒ½çŠ¶æ€
- **monitor_markdown.sh** - MarkdownåŠŸèƒ½ç›‘æ§
- **verify_image_server.sh** - éªŒè¯å›¾ç‰‡æœåŠ¡å™¨çŠ¶æ€

## ğŸš€ ä½¿ç”¨è¯´æ˜

### Systemd éƒ¨ç½²

#### ä¸€é”®å¯åŠ¨
```bash
cd /root/project-wb/dingtalk_bot
sudo ./scripts/start.sh
```

è¯¥è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥rootæƒé™
- åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
- å®‰è£…ä¾èµ–
- å®‰è£…systemdæœåŠ¡
- å¯åŠ¨æœåŠ¡
- è®¾ç½®å¼€æœºè‡ªå¯

#### æŸ¥çœ‹çŠ¶æ€
```bash
./scripts/status.sh
```

æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚

#### åœæ­¢æœåŠ¡
```bash
sudo ./scripts/stop.sh
```

åœæ­¢æ‰€æœ‰ç›¸å…³æœåŠ¡ã€‚

### Docker éƒ¨ç½²

#### ä¸€é”®éƒ¨ç½²
```bash
sudo ./scripts/docker-deploy.sh
```

è¯¥è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥å¹¶å®‰è£…Dockerå’ŒDocker Compose
- æ„å»ºé•œåƒ
- å¯åŠ¨å®¹å™¨
- é…ç½®æ•°æ®æŒä¹…åŒ–

#### Dockerç®¡ç†
```bash
# å¯åŠ¨å®¹å™¨
./scripts/docker-start.sh

# åœæ­¢å®¹å™¨
./scripts/docker-stop.sh

# æŸ¥çœ‹çŠ¶æ€
./scripts/docker-status.sh
```

### ç›‘æ§å’ŒéªŒè¯

#### æ£€æŸ¥å¼‚æ­¥åŠŸèƒ½
```bash
./scripts/check_async_status.sh
```

æ£€æŸ¥é¡¹ï¼š
- dingtalk_sender.py æ˜¯å¦å­˜åœ¨
- async_task_manager.py æ˜¯å¦å­˜åœ¨
- é…ç½®æ–‡ä»¶ä¸­çš„å¼‚æ­¥ä»»åŠ¡è®¾ç½®
- å¼‚æ­¥ä»»åŠ¡æ—¥å¿—

#### éªŒè¯å›¾ç‰‡æœåŠ¡å™¨
```bash
./scripts/verify_image_server.sh
```

æ£€æŸ¥é¡¹ï¼š
- å›¾ç‰‡æœåŠ¡å™¨ç«¯å£æ˜¯å¦ç›‘å¬
- Nginxä»£ç†æ˜¯å¦é…ç½®
- å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å¯è®¿é—®
- ç¯å¢ƒå˜é‡é…ç½®

#### MarkdownåŠŸèƒ½ç›‘æ§
```bash
./scripts/monitor_markdown.sh
```

ç›‘æ§Markdownæ¶ˆæ¯å‘é€æƒ…å†µã€‚

## ğŸ“‹ è„šæœ¬è¯¦ç»†è¯´æ˜

### start.sh - ä¸€é”®å¯åŠ¨è„šæœ¬

**åŠŸèƒ½**ï¼š
1. æ£€æŸ¥rootæƒé™
2. æ£€æŸ¥å¹¶åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
3. æ£€æŸ¥.envé…ç½®æ–‡ä»¶
4. å®‰è£…systemdæœåŠ¡
5. å®‰è£…Pythonä¾èµ–
6. å¯åŠ¨æœåŠ¡
7. è®¾ç½®å¼€æœºè‡ªå¯

**ä½¿ç”¨**ï¼š
```bash
sudo ./scripts/start.sh
```

**æ—¥å¿—ä½ç½®**ï¼š
- `/var/log/dingtalk-bot.log`

### stop.sh - åœæ­¢è„šæœ¬

**åŠŸèƒ½**ï¼š
1. åœæ­¢dingtalk-botæœåŠ¡
2. åœæ­¢image-serveræœåŠ¡
3. æ˜¾ç¤ºæœåŠ¡çŠ¶æ€

**ä½¿ç”¨**ï¼š
```bash
sudo ./scripts/stop.sh
```

### status.sh - çŠ¶æ€æŸ¥çœ‹è„šæœ¬

**åŠŸèƒ½**ï¼š
1. æ˜¾ç¤ºdingtalk-botæœåŠ¡çŠ¶æ€
2. æ˜¾ç¤ºimage-serveræœåŠ¡çŠ¶æ€
3. æ˜¾ç¤ºæœ€è¿‘çš„æ—¥å¿—

**ä½¿ç”¨**ï¼š
```bash
./scripts/status.sh
```

### docker-deploy.sh - Dockeréƒ¨ç½²è„šæœ¬

**åŠŸèƒ½**ï¼š
1. æ£€æŸ¥Dockerå’ŒDocker Compose
2. è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„å·¥å…·
3. åˆ›å»ºé¡¹ç›®ç›®å½•
4. ç”Ÿæˆé…ç½®æ–‡ä»¶
5. æ„å»ºDockeré•œåƒ
6. å¯åŠ¨å®¹å™¨

**ä½¿ç”¨**ï¼š
```bash
sudo ./scripts/docker-deploy.sh
```

### verify_image_server.sh - å›¾ç‰‡æœåŠ¡å™¨éªŒè¯

**åŠŸèƒ½**ï¼š
1. æ£€æŸ¥8090ç«¯å£ç›‘å¬
2. æ£€æŸ¥Nginxé…ç½®
3. æµ‹è¯•å›¾ç‰‡è®¿é—®
4. æ£€æŸ¥ç¯å¢ƒå˜é‡

**ä½¿ç”¨**ï¼š
```bash
./scripts/verify_image_server.sh
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
âœ“ å›¾ç‰‡æœåŠ¡å™¨ç«¯å£8090æ­£åœ¨ç›‘å¬
âœ“ Nginxé…ç½®æ­£ç¡®
âœ“ å›¾ç‰‡å¯ä»¥è®¿é—®
âœ“ ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
```

### check_async_status.sh - å¼‚æ­¥åŠŸèƒ½æ£€æŸ¥

**åŠŸèƒ½**ï¼š
1. æ£€æŸ¥å¼‚æ­¥æ¨¡å—æ–‡ä»¶
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. åˆ†ææ—¥å¿—ä¸­çš„å¼‚æ­¥ä»»åŠ¡
4. æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯

**ä½¿ç”¨**ï¼š
```bash
./scripts/check_async_status.sh
```

## ğŸ”§ è‡ªå®šä¹‰è„šæœ¬

å¦‚éœ€ä¿®æ”¹è„šæœ¬è¡Œä¸ºï¼Œå¯ä»¥ç¼–è¾‘ç›¸åº”è„šæœ¬æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š

### ä¿®æ”¹æœåŠ¡å®‰è£…è·¯å¾„

ç¼–è¾‘ `start.sh`ï¼Œä¿®æ”¹ï¼š
```bash
PROJECT_DIR="/root/project-wb/dingtalk_bot"
```

### ä¿®æ”¹æ—¥å¿—ä½ç½®

ç¼–è¾‘systemdæœåŠ¡æ–‡ä»¶ä¸­çš„æ—¥å¿—è·¯å¾„ï¼š
```bash
StandardOutput=append:/var/log/dingtalk-bot.log
```

### æ·»åŠ è‡ªå®šä¹‰æ£€æŸ¥

å¯ä»¥åœ¨ `status.sh` ä¸­æ·»åŠ é¢å¤–çš„å¥åº·æ£€æŸ¥ï¼š
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /root/project-wb/dingtalk_bot

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
```

## ğŸ› æ•…éšœæ’æŸ¥

### è„šæœ¬æ‰§è¡Œå¤±è´¥

1. **æ£€æŸ¥æƒé™**
   ```bash
   ls -la scripts/
   # ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ (rwxr-xr-x)
   ```

2. **æ·»åŠ æ‰§è¡Œæƒé™**
   ```bash
   chmod +x scripts/*.sh
   ```

3. **æ£€æŸ¥è„šæœ¬è¯­æ³•**
   ```bash
   bash -n scripts/start.sh
   ```

### æœåŠ¡å¯åŠ¨å¤±è´¥

1. **æŸ¥çœ‹è„šæœ¬è¾“å‡º**
   è„šæœ¬ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

2. **æ‰‹åŠ¨æ‰§è¡Œæ­¥éª¤**
   æŒ‰ç…§è„šæœ¬é€»è¾‘æ‰‹åŠ¨æ‰§è¡Œæ¯ä¸€æ­¥ï¼Œå®šä½é—®é¢˜

3. **æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—**
   ```bash
   sudo journalctl -xe
   ```

## ğŸ“ æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**
   - åœ¨é‡å¤§æ“ä½œå‰å¤‡ä»½é…ç½®æ–‡ä»¶
   - ä½¿ç”¨Gitç®¡ç†é…ç½®å˜æ›´

2. **æ—¥å¿—ç®¡ç†**
   - å®šæœŸæ¸…ç†æ—§æ—¥å¿—
   - é…ç½®logrotate

3. **ç›‘æ§å‘Šè­¦**
   - è®¾ç½®å®šæ—¶ä»»åŠ¡è¿è¡Œstatus.sh
   - é…ç½®å¼‚å¸¸å‘Šè­¦

4. **æƒé™å®‰å…¨**
   - è„šæœ¬ä½¿ç”¨é€‚å½“çš„æƒé™
   - æ•æ„Ÿä¿¡æ¯ä¸å†™å…¥è„šæœ¬

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [systemd/README.md](../systemd/README.md) - SystemdæœåŠ¡é…ç½®è¯´æ˜
- [nginx/README.md](../nginx/README.md) - Nginxé…ç½®è¯´æ˜
- [README.md](../README.md) - é¡¹ç›®ä¸»æ–‡æ¡£
